<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="KSHITIJ SARAOGI">
    <meta name="description" content="Kshitij Saraogi&#39;s personal website">
    <meta name="keywords" content="blog,developer,personal">

    <base href="https://kshitij10496.github.io/">
    <title>
  Magical Files ¬∑ kshitij10496
</title>

    <link rel="canonical" href="https://kshitij10496.github.io/posts/magical-files/">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Merriweather:300,700|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://kshitij10496.github.io/css/coder.min.b700a5478d33a4b06fa64fda9115605b92a8bd20085b1c9f79d7e6c2e31bf084.css" integrity="sha256-twClR40zpLBvpk/akRVgW5KovSAIWxyfedfmwuMb8IQ=" crossorigin="anonymous" media="screen" />
    

    

    

    

    <link rel="icon" type="image/png" href="https://kshitij10496.github.io/images/logo.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://kshitij10496.github.io/images/logo.png" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.47.1" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://kshitij10496.github.io/">
      kshitij10496
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://kshitij10496.github.io/about/">ABOUT</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://kshitij10496.github.io/posts/">BLOG</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://kshitij10496.github.io/values/">VALUES</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://kshitij10496.github.io/quotes/">QUOTES</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://drive.google.com/file/d/1-PqZNNRAuCvtquXWbgvBFEyrTRDwesKV/view?usp=sharing">R√âSUM√â</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Magical Files</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2019-02-10T20:47:16&#43;05:30'>
                February 10, 2019
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              3 minutes read
            </span>
          </div>
          <div class="categories">
  <i class="fas fa-folder"></i>
    <a href="https://kshitij10496.github.io/categories/project/">Project</a>
      <span class="separator">‚Ä¢</span>
    <a href="https://kshitij10496.github.io/categories/software/">Software</a></div>

          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://kshitij10496.github.io/tags/unix/">unix</a>
      <span class="separator">‚Ä¢</span>
    <a href="https://kshitij10496.github.io/tags/osx/">osx</a>
      <span class="separator">‚Ä¢</span>
    <a href="https://kshitij10496.github.io/tags/linux/">linux</a></div>

        </div>
      </header>

      <div>
        

<h1 id="context">Context</h1>

<p>My <code>Downloads</code> folder is a mess!</p>

<p>I have got hundreds of files in that directory.
Most of them are PDF documents with some images, archives and disk images.</p>

<p>&ldquo;Is there a way to only list all the PDF files present in a directory?&rdquo;</p>

<p>Well, filtering based on file extension (<code>.pdf</code>) should be able to do this for me.
Moreover, I can leverage the power of regular expression: <code>$ ls -lh ~/Downloads/*.pdf</code></p>

<p>After some experimentation, I discovered that a non-negligible number of files stored in PDF format existed which did not have a <code>.pdf</code> extension üò±:</p>

<ol>
<li>The university&rsquo;s portal only allows us to download PDFs with a <code>.jsp</code> extension. üòì</li>
<li>I had a <code>FileHandler.ashx</code> file that also contained data in PDF format.</li>
</ol>

<p>These findings helped me infer that the use of <code>*.pdf</code> RegEx is not robust enough to ensure that all PDF documents are selected.
Apparently, even the OSX&rsquo;s Finder fails at detecting the file &ldquo;Kind&rdquo; for <code>FileHandler.ashx</code>.</p>

<p><img src="images/magical-files-finder.png" alt="Finder" /></p>

<p>Looking for something more sophisticated, eh?</p>

<h1 id="detour-magic-numbers">Detour: Magic Numbers ‚ú®</h1>

<p>What is a <strong>magic number</strong>?<br />
Any constant numerical or text value that you find in your code is a magic number, especially the ones you &ldquo;forget&rdquo; to comment/document.</p>

<p>Interestingly enough, many files have such constants that identify the contained data.
In addition to this, detecting such constants in files is a simple and effective way of distinguishing between many file formats. üò≤
These magic numbers, used to identify or verify the content of a file, are also called &ldquo;file signatures&rdquo;.</p>

<p>Examples:</p>

<ol>
<li>PDF documents begin with <code>%PDF</code> text - the corresponding magic number for this format.</li>
<li>Shebang (<code>!/usr/bin/sh</code>) line in script files is a human readable file signature.</li>
<li><code>&lt;!DOCTYPE HTML&gt;</code> indicate HTML documents.</li>
</ol>

<p><strong>caution</strong> ‚ö†Ô∏è:</p>

<p>The magic number approach offers better guarantees that the format will be identified correctly, and can often determine more precise information about the file.</p>

<ol>
<li>Since reasonably reliable &ldquo;magic number&rdquo; tests can be fairly complex, and each file must effectively be tested against every possibility in the magic database, this approach is relatively inefficient, especially for displaying large lists of files.</li>
<li>Also, data must be read from the file itself, increasing latency as opposed to metadata stored in the directory.</li>
<li>Where file types don&rsquo;t lend themselves to recognition in this way, the system must fall back to metadata.
<br /></li>
</ol>

<p><strong>green light</strong> ‚úÖ:</p>

<p>Failing a well-designed magic number test is a <strong>pretty sure sign</strong> that the file is either <strong>corrupt</strong> or of the <strong>wrong type</strong>.
On the other hand, a valid magic number <strong>does not guarantee</strong> that the file is not corrupt or is of a correct type.</p>

<h1 id="preliminary-research">Preliminary Research</h1>

<p>I have previously used the Unix <code>file</code> command for determining the file type by performing some &ldquo;tests&rdquo; via system calls.
One of them is the <strong>magic test</strong> which checks the file header for the existence of these magic numbers using the <code>libmagic</code> library written in C.</p>

<p>The next question confronting me: &ldquo;Is there a way to use the libmagic library from Go?&rdquo;</p>

<p>That&rsquo;s when I found the <a href="https://github.com/rakyll/magicmime">rakyll/magicmime</a> package from the inimitable JBD. üéâ<br />
It provides Go bindings for the <code>libmagic</code> library - exactly what I was looking for! üòÅ</p>

<h1 id="solution">Solution</h1>

<p>This week I will be developing a CLI using <a href="https://github.com/spf13/cobra">spf13/cobra</a> which can help the users filter files based on it&rsquo;s format. My intention is to make a simple, decoupled and UNIX pipe compatible tool that plays well with other utilities.
With my university exams starting in 10 days, this week would be the optimal period for me to work on the project.</p>

<p>In case there are any existing solutions for solving this, do let me know!<br />
If you currently experience this problem, I would love to hear your thoughts. üòÉ</p>

<h1 id="references">References</h1>

<ol>
<li><a href="https://en.wikipedia.org/wiki/Magic_number_(programming)">Magic number</a></li>
<li><a href="https://en.wikipedia.org/wiki/File_(command)">file command</a></li>
<li><a href="https://en.wikipedia.org/wiki/File_format">File format</a></li>
<li><a href="https://en.wikipedia.org/wiki/List_of_file_signatures">List of file signatures</a></li>
</ol>

      </div>

      <footer>
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "kshitij10496" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
      <p>Hello Friend</p>
    
     ¬© 2019
    
       ¬∑ 
      Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
    
  </section>
</footer>

    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-125667904-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


  </body>

</html>
